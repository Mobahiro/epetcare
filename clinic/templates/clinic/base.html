<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ePetCare{% endblock %}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'clinic/styles.css' %}?v={% now "U" %}">
    <link rel="stylesheet" href="{% static 'clinic/modal.css' %}?v={% now "U" %}">
    <!-- Modern UI enhancements -->
    <link rel="stylesheet" href="{% static 'clinic/modern.css' %}?v={% now "U" %}">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="{% static 'clinic/refresh.js' %}?v={% now "U" %}" defer></script>
    <script src="{% static 'clinic/main.js' %}?v={% now "U" %}" defer></script>
    <!-- Modern interactivity -->
    <script src="{% static 'clinic/modern.js' %}?v={% now "U" %}" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="{% static 'clinic/images/epetcare-favicon.png' %}">
    <link rel="icon" type="image/svg+xml" href="{% static 'clinic/images/epetcare-favicon.svg' %}">
    <link rel="apple-touch-icon" href="{% static 'clinic/images/epetcare-favicon.png' %}">
    {% block head %}{% endblock %}
</head>
<body>
    <header class="site-header">
        <div class="header-inner">
            <div class="brand-container">
                <a class="brand" href="{% url 'home' %}">
                    <div class="brand-logo">
                        <img src="{% static 'clinic/images/epetcare-logo.png' %}" alt="ePetCare Logo" class="logo-icon">
                    </div>
                    <div class="brand-text">
                        <strong>ePetCare</strong>
                        <div class="tagline">Pet Health Management System</div>
                    </div>
                </a>
            </div>
            <button class="mobile-menu-toggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
                        <nav class="nav" id="main-nav">
                                <div class="nav-items">
                                        {% if request.user.is_authenticated %}
                                                <div class="profile-menu">
                                                    <button class="profile-trigger" id="profileTrigger" aria-haspopup="menu" aria-expanded="false">
                                                        <div class="avatar-sm" aria-hidden="true">
                                                            {% if request.user.first_name %}{{ request.user.first_name|slice:':1'|upper }}{% else %}{{ request.user.username|slice:':1'|upper }}{% endif %}
                                                        </div>
                                                        <span class="profile-name">{{ request.user.get_full_name|default:request.user.username }}</span>
                                                        <span class="caret" aria-hidden="true">â–¾</span>
                                                    </button>
                                                    <div class="profile-dropdown" id="profileDropdown" role="menu" hidden>
                                                        <a class="profile-item" role="menuitem" href="{% url 'dashboard' %}">Dashboard</a>
                                                        <a class="profile-item" role="menuitem" href="{% url 'pet_list' %}">Pets</a>
                                                        <a class="profile-item" role="menuitem" href="{% url 'appointment_list' %}">Appointments</a>
                                                        <a class="profile-item" role="menuitem" href="{% url 'profile' %}">Profile</a>
                                                        {% if request.user.is_staff %}
                                                            <hr>
                                                            <a class="profile-item" role="menuitem" href="{% url 'owner_list' %}">Owners</a>
                                                        {% endif %}
                                                        <hr>
                                                        <a class="profile-item danger" role="menuitem" href="{% url 'logout' %}">Logout</a>
                                                    </div>
                                                </div>
                                        {% else %}
                        <a class="nav-link {% if request.path == '/' %}active{% endif %}" href="{% url 'home' %}">Home</a>
                        <a class="nav-link {% if request.path == '/about/' %}active{% endif %}" href="{% url 'about_us' %}">About Us</a>
                        <a class="nav-link {% if request.path == '/login/' %}active{% endif %}" href="{% url 'login' %}">Login</a>
                        <a class="nav-link {% if request.path == '/register/' %}active{% endif %}" href="{% url 'register' %}">Register</a>
                    {% endif %}

                    {% if request.user.is_staff %}
                        <a class="nav-link nav-with-icon {% if '/owner/' in request.path %}active{% endif %}" href="{% url 'owner_list' %}" title="Owners" aria-label="Owners"><span class="icon">ðŸ‘¥</span><span class="label">Owners</span></a>
                    {% endif %}
                </div>
            </nav>
        </div>
    </header>

        {# Render toasts on most pages, but suppress them on public pages like Home/About. #}
                {% if messages %}
                    {% if request.resolver_match %}
                        {% if request.resolver_match.url_name == 'home' or request.resolver_match.url_name == 'about_us' %}
                            {# Consume messages silently on Home/About so they won't spill into later pages #}
                            {% for _ in messages %}{% endfor %}
                        {% else %}
                            <div id="toast-container">
                                {% for message in messages %}
                                        <div class="toast {{ message.tags }}">
                                                {{ message }}
                                                <button class="toast-close">&times;</button>
                                        </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% else %}
                        <div id="toast-container">
                            {% for message in messages %}
                                    <div class="toast {{ message.tags }}">
                                            {{ message }}
                                            <button class="toast-close">&times;</button>
                                    </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endif %}

    <main class="site-main">
        {% block content %}{% endblock %}
    </main>
    <footer class="site-footer">
        <div class="footer-container footer-inner">
            <div class="footer-brand">
                <div class="footer-logo">
                    <img src="{% static 'clinic/images/epetcare-logo.png' %}" alt="ePetCare Logo" class="footer-logo-icon">
                    <span>ePetCare</span>
                </div>
                <div class="footer-tagline">Your Pet's Health Companion</div>
            </div>
            <div class="footer-links">
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="{% url 'home' %}">Home</a></li>
                        <li><a href="{% url 'dashboard' %}">Dashboard</a></li>
                        <li><a href="{% url 'pet_list' %}">Pets</a></li>
                        <li><a href="{% url 'appointment_list' %}">Appointments</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="#">Pet Care Tips</a></li>
                        <li><a href="#">Emergency Services</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
            </div>
        </div>
    <div class="footer-bottom footer-inner">
            <div class="copyright">Â© 2025 ePetCare. All rights reserved.</div>
            <div class="footer-social">
                <a href="#" class="social-link">Facebook</a>
                <a href="#" class="social-link">Twitter</a>
                <a href="#" class="social-link">Instagram</a>
            </div>
        </div>
    </footer>

    <script>
        // DOM loaded event handler
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-dismiss toast notifications
            const toasts = document.querySelectorAll('.toast');

            // Add click handler to close buttons
            document.querySelectorAll('.toast-close').forEach(button => {
                button.addEventListener('click', function() {
                    const toast = this.parentElement;
                    toast.classList.add('toast-hiding');
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                });
            });

            // Auto-dismiss after 5 seconds
            toasts.forEach(toast => {
                setTimeout(() => {
                    toast.classList.add('toast-hiding');
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, 5000);
            });

            // Mobile menu toggle functionality
            const menuToggle = document.querySelector('.mobile-menu-toggle');
            const mainNav = document.getElementById('main-nav');

            if (menuToggle && mainNav) {
                menuToggle.addEventListener('click', function() {
                    menuToggle.classList.toggle('active');
                    mainNav.classList.toggle('active');
                    document.body.classList.toggle('menu-open');
                });

                // Close menu when clicking a link
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', function() {
                        menuToggle.classList.remove('active');
                        mainNav.classList.remove('active');
                        document.body.classList.remove('menu-open');
                    });
                });
            }

                        // Profile dropdown toggle
                        const profileTrigger = document.getElementById('profileTrigger');
                        const profileDropdown = document.getElementById('profileDropdown');
                        function closeProfile(){ if (!profileDropdown) return; profileDropdown.hidden = true; profileTrigger?.setAttribute('aria-expanded','false'); }
                        function openProfile(){ if (!profileDropdown) return; profileDropdown.hidden = false; profileTrigger?.setAttribute('aria-expanded','true'); }
                        profileTrigger?.addEventListener('click', function(e){
                            e.stopPropagation();
                            if (profileDropdown.hidden) openProfile(); else closeProfile();
                        });
                        document.addEventListener('click', function(e){
                            if (!profileDropdown || !profileTrigger) return;
                            if (!profileDropdown.hidden && !profileDropdown.contains(e.target) && e.target !== profileTrigger) {
                                closeProfile();
                            }
                        });
                        document.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeProfile(); });
        });
    </script>
</body>
</html>