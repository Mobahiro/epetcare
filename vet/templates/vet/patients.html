{% extends 'vet/base.html' %}
{% load static %}
{% block title %}Patients - Veterinarian Portal{% endblock %}

{% block head_extra %}
<style>
  .page-hero {
    background: linear-gradient(135deg, rgba(203, 153, 126, 0.15), rgba(107, 112, 92, 0.08));
    border-radius: 16px;
    padding: 28px 32px;
    margin-bottom: 24px;
    border: 1px solid var(--vet-border, #e8e4df);
  }
  .page-hero h1 {
    font-size: 24px;
    font-weight: 700;
    color: var(--vet-text, #3a3632);
    margin: 0 0 8px 0;
  }
  .page-hero p {
    font-size: 14px;
    color: var(--vet-text-secondary, #6b6560);
    margin: 0;
  }
  .summary-tiles {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }
  .tile {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    border: 1px solid var(--vet-border, #e8e4df);
  }
  .tile-head {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }
  .tile-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: linear-gradient(135deg, rgba(203, 153, 126, 0.2), rgba(107, 112, 92, 0.1));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
  }
  .tile-title {
    font-weight: 600;
    font-size: 14px;
    color: var(--vet-text, #3a3632);
  }
  .tile-sub {
    font-size: 12px;
    color: var(--vet-text-secondary, #6b6560);
  }
  .tile-metric {
    font-size: 28px;
    font-weight: 700;
    color: var(--vet-text, #3a3632);
  }
  .search-bar {
    display: flex;
    gap: 12px;
    align-items: center;
    margin-bottom: 20px;
  }
  .search-input {
    flex: 1;
    max-width: 320px;
    padding: 10px 16px;
    border: 1px solid var(--vet-border, #e8e4df);
    border-radius: 8px;
    font-size: 14px;
    background: #fff;
  }
  .search-input:focus {
    outline: none;
    border-color: var(--vet-accent, #cb997e);
    box-shadow: 0 0 0 3px rgba(203, 153, 126, 0.1);
  }
  .main-card {
    background: #fff;
    border-radius: 16px;
    border: 1px solid var(--vet-border, #e8e4df);
    overflow: hidden;
  }
  .card-head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid var(--vet-border, #e8e4df);
  }
  .card-head h2 {
    font-size: 18px;
    font-weight: 600;
    color: var(--vet-text, #3a3632);
    margin: 0;
  }
  .patients-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
    padding: 20px;
  }
  .patient-card {
    background: #fff;
    border: 1px solid var(--vet-border, #e8e4df);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.2s ease;
    cursor: pointer;
  }
  .patient-card:hover {
    border-color: var(--vet-accent, #cb997e);
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transform: translateY(-2px);
  }
  .patient-header {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 16px;
  }
  .patient-avatar {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    background: linear-gradient(135deg, var(--vet-accent, #cb997e), var(--vet-accent-light, #ddbea9));
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 18px;
  }
  .patient-name {
    font-weight: 600;
    font-size: 16px;
    color: var(--vet-text, #3a3632);
    margin-bottom: 2px;
  }
  .patient-species {
    font-size: 13px;
    color: var(--vet-text-secondary, #6b6560);
  }
  .patient-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  .detail-item {
    font-size: 13px;
  }
  .detail-label {
    color: var(--vet-text-secondary, #6b6560);
    margin-bottom: 2px;
  }
  .detail-value {
    color: var(--vet-text, #3a3632);
    font-weight: 500;
  }
  .empty-state {
    text-align: center;
    padding: 48px 20px;
    color: var(--vet-text-secondary, #6b6560);
  }
  .empty-state-icon {
    font-size: 48px;
    margin-bottom: 16px;
  }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="page-hero">
  <h1>Patients</h1>
  <p>View all registered pets and their information.</p>
</div>

<!-- Summary Tiles -->
<div class="summary-tiles">
  <div class="tile">
    <div class="tile-head">
      <div class="tile-icon">üêæ</div>
      <div class="tile-text">
        <div class="tile-title">Total Patients</div>
        <div class="tile-sub">Registered</div>
      </div>
    </div>
    <div class="tile-metric">{{ pets|length }}</div>
  </div>
  <div class="tile">
    <div class="tile-head">
      <div class="tile-icon">üêï</div>
      <div class="tile-text">
        <div class="tile-title">Dogs</div>
        <div class="tile-sub">Patients</div>
      </div>
    </div>
    <div class="tile-metric">{{ dog_count|default:"0" }}</div>
  </div>
  <div class="tile">
    <div class="tile-head">
      <div class="tile-icon">üêà</div>
      <div class="tile-text">
        <div class="tile-title">Cats</div>
        <div class="tile-sub">Patients</div>
      </div>
    </div>
    <div class="tile-metric">{{ cat_count|default:"0" }}</div>
  </div>
</div>

<!-- Search Bar -->
<div class="search-bar">
  <input type="text" id="patientSearch" class="search-input" placeholder="üîç Search patients by name or owner...">
</div>

<!-- Patients Grid -->
<div class="main-card">
  <div class="card-head">
    <h2>All Patients</h2>
  </div>
  
  <div class="patients-grid" id="patientsGrid">
    {% for pet in pets %}
      <div class="patient-card" data-pet-name="{{ pet.name|lower }}" data-owner-name="{{ pet.owner.full_name|lower }}">
        <div class="patient-header">
          <div class="patient-avatar">{{ pet.name|slice:":1"|upper }}</div>
          <div>
            <div class="patient-name">{{ pet.name }}</div>
            <div class="patient-species">{{ pet.get_species_display }}{% if pet.breed %} ‚Ä¢ {{ pet.breed }}{% endif %}</div>
          </div>
        </div>
        <div class="patient-details">
          <div class="detail-item">
            <div class="detail-label">Owner</div>
            <div class="detail-value">{{ pet.owner.full_name }}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Sex</div>
            <div class="detail-value">{{ pet.get_sex_display }}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Birth Date</div>
            <div class="detail-value">{% if pet.birth_date %}{{ pet.birth_date|date:"M d, Y" }}{% else %}‚Äî{% endif %}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Weight</div>
            <div class="detail-value">{% if pet.weight_kg %}{{ pet.weight_kg }} kg{% else %}‚Äî{% endif %}</div>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="empty-state" style="grid-column: 1 / -1;">
        <div class="empty-state-icon">üêæ</div>
        <div>No patients found.</div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('patientSearch');
    const patientCards = document.querySelectorAll('.patient-card');
    
    searchInput.addEventListener('keyup', function() {
      const searchTerm = this.value.toLowerCase();
      
      patientCards.forEach(card => {
        const petName = card.getAttribute('data-pet-name');
        const ownerName = card.getAttribute('data-owner-name');
        
        if (petName.includes(searchTerm) || ownerName.includes(searchTerm)) {
          card.style.display = '';
        } else {
          card.style.display = 'none';
        }
      });
    });
  });
</script>
{% endblock %}
