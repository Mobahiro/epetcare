{% extends 'vet_portal/base.html' %}
{% load static %}

{% block title %}Dashboard - ePetCare Vet Portal{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12 text-center">
        <h1 style="color: #6B705C; margin-bottom: 15px;">Welcome, Dr. {{ vet.full_name }}!</h1>
        <p style="font-size: 16px; color: #666666;">Here's what's happening at your clinic today</p>
        <hr style="border: 1px dashed #A5A58D; margin: 20px 0;">
    </div>
</div>

<!-- Stats Cards -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="dashboard-card">
            <div class="dashboard-card-title">
                üêæ Total Patients
            </div>
            <div class="dashboard-stat">
                {{ total_pets }}
            </div>
            <div class="dashboard-stat-label">
                Pets under your care
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="dashboard-card">
            <div class="dashboard-card-title">
                üìÖ Upcoming Appointments
            </div>
            <div class="dashboard-stat">
                {{ total_appointments }}
            </div>
            <div class="dashboard-stat-label">
                Scheduled visits
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="dashboard-card">
            <div class="dashboard-card-title">
                üíä Active Prescriptions
            </div>
            <div class="dashboard-stat">
                {{ total_pending_prescriptions }}
            </div>
            <div class="dashboard-stat-label">
                Current treatments
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Today's Appointments -->
    <div class="col-lg-8 mb-4">
        <div class="card">
            <div class="card-header">
                Today's Appointments
                <a href="{% url 'vet_portal:appointment_list' %}" style="float: right; text-decoration: underline; color: #CB997E;">
                    View All
                </a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Pet</th>
                                <th>Owner</th>
                                <th>Reason</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for appointment in today_appointments %}
                                <tr>
                                    <td>{{ appointment.date_time|date:"H:i" }}</td>
                                    <td>
                                        <a href="{% url 'vet_portal:patient_detail' appointment.pet.id %}">
                                            {{ appointment.pet.name }}
                                        </a>
                                    </td>
                                    <td>{{ appointment.pet.owner.full_name }}</td>
                                    <td>{{ appointment.reason }}</td>
                                    <td>
                                        {% if appointment.status == 'scheduled' %}
                                            <span class="badge" style="background-color: #A5A58D;">Scheduled</span>
                                        {% elif appointment.status == 'completed' %}
                                            <span class="badge" style="background-color: #6B8E23;">Completed</span>
                                        {% elif appointment.status == 'cancelled' %}
                                            <span class="badge" style="background-color: #BC6C25;">Cancelled</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{% url 'vet_portal:appointment_detail' appointment.id %}" class="btn btn-primary">
                                            View
                                        </a>
                                    </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 30px;">
                                        <div style="color: #A5A58D;">
                                            <div style="font-size: 24px; margin-bottom: 10px;">üìÜ</div>
                                            No appointments scheduled for today
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div style="text-align: center; padding: 15px; background-color: #F1E3D3; border-top: 1px solid #E6CCB2;">
                <a href="{% url 'vet_portal:appointment_create' %}" class="btn btn-primary">
                    + New Appointment
                </a>
            </div>
        </div>
    </div>
    
    <!-- Notifications -->
    <div class="col-lg-4 mb-4">
        <div class="card">
            <div class="card-header">
                Recent Notifications
                <a href="{% url 'vet_portal:mark_all_notifications_read' %}" style="float: right; text-decoration: underline; color: #CB997E;">
                    Mark All Read
                </a>
            </div>
            <div class="card-body">
                {% for notification in notifications %}
                    {% if not notification.is_read %}
                    <div style="padding: 10px; margin-bottom: 10px; border-bottom: 1px solid #E6CCB2; background-color: #FFE8D6; border-left: 3px solid #CB997E;">
                    {% else %}
                    <div style="padding: 10px; margin-bottom: 10px; border-bottom: 1px solid #E6CCB2;">
                    {% endif %}
                        <div style="font-weight: bold; margin-bottom: 5px;">{{ notification.title }}</div>
                        <div style="font-size: 14px; color: #666666;">{{ notification.message|truncatechars:80 }}</div>
                        <div style="font-size: 12px; color: #999999; text-align: right;">
                            {{ notification.created_at|timesince }} ago
                        </div>
                        <div style="text-align: right; margin-top: 5px;">
                            <a href="{% url 'vet_portal:mark_notification_read' notification.id %}" 
                               style="color: #CB997E; text-decoration: underline; font-size: 14px;">
                                Mark as read
                            </a>
                        </div>
                    </div>
                {% empty %}
                    <div style="text-align: center; padding: 30px; color: #A5A58D;">
                        <div style="font-size: 24px; margin-bottom: 10px;">üîî</div>
                        No new notifications
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Recent Medical Records -->
<div class="row">
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header">
                Recent Medical Records
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Pet</th>
                                <th>Owner</th>
                                <th>Condition</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for record in recent_records %}
                                <tr>
                                    <td>{{ record.visit_date }}</td>
                                    <td>
                                        <a href="{% url 'vet_portal:patient_detail' record.pet.id %}">
                                            {{ record.pet.name }}
                                        </a>
                                    </td>
                                    <td>{{ record.pet.owner.full_name }}</td>
                                    <td>{{ record.condition }}</td>
                                    <td>
                                        <a href="{% url 'vet_portal:medical_record_detail' record.id %}" class="btn btn-primary">
                                            View
                                        </a>
                                    </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: 30px;">
                                        <div style="color: #A5A58D;">
                                            <div style="font-size: 24px; margin-bottom: 10px;">üìã</div>
                                            No medical records found
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Connection Status Indicator -->
<div style="position: fixed; bottom: 20px; right: 20px; padding: 10px 15px; 
          background-color: #6B8E23; color: white; border-radius: 5px; 
          box-shadow: 0 2px 5px rgba(0,0,0,0.2); display: none;" id="connection-status">
    Online
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Simple connection status checker
    window.addEventListener('load', function() {
        var statusElement = document.getElementById('connection-status');
        
        function updateStatus() {
            if (navigator.onLine) {
                statusElement.textContent = '‚úì Online';
                statusElement.style.backgroundColor = '#6B8E23';
                statusElement.style.display = 'none'; // Hide when online
            } else {
                statusElement.textContent = '‚úó Offline';
                statusElement.style.backgroundColor = '#BC6C25';
                statusElement.style.display = 'block'; // Show when offline
            }
        }
        
        window.addEventListener('online', updateStatus);
        window.addEventListener('offline', updateStatus);
        updateStatus();
    });
</script>
{% endblock %}
