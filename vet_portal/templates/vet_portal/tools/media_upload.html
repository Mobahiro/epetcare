{% extends 'vet_portal/base.html' %}
{% load static %}
{% block title %}Upload Pet Image{% endblock %}
{% block content %}
<div class="container">
  <h2>Upload Pet Image</h2>
  <p class="text-muted">Use this form to attach an image to a pet record.</p>
  <form id="uploadForm" method="post" enctype="multipart/form-data" action="{# we will handle with JS to call API #}">
    {% csrf_token %}
    <div class="mb-3">
      <label for="pet_id" class="form-label">Pet ID</label>
      <input type="number" id="pet_id" name="pet_id" class="form-control" required />
    </div>
    <div class="mb-3">
      <label for="file" class="form-label">Image File</label>
      <input type="file" id="file" name="file" class="form-control" accept="image/*" required />
    </div>
    <button type="submit" class="btn btn-primary">Upload</button>
  </form>
  <div id="result" class="mt-3"></div>
</div>
<script>
  document.getElementById('uploadForm').addEventListener('submit', async function(e){
    e.preventDefault();
    const form = e.target;
    const petId = form.pet_id.value;
    const fileInput = form.file;
    const result = document.getElementById('result');
    result.textContent = 'Uploading...';

    const data = new FormData();
    data.append('pet_id', petId);
    if (fileInput.files.length) {
      data.append('file', fileInput.files[0]);
    }

    try {
      const resp = await fetch('/vet_portal/api/media/upload/', {
        method: 'POST',
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: data,
        credentials: 'same-origin'
      });
      const json = await resp.json();
      result.textContent = JSON.stringify(json, null, 2);
    } catch (err) {
      result.textContent = 'Error: ' + err;
    }
  });
</script>
{% endblock %}
