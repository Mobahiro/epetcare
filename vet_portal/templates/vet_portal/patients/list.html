{% extends 'vet_portal/dashboard_base.html' %}
{% load static %}
{% block title %}Patients - ePetCare Vet Portal{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'clinic/dashboard-common.css' %}?v={% now 'U' %}">
{% endblock %}

{% block dash_content %}
<!-- Hero section -->
<section class="dash-hero">
  <div class="hero-main">
    <div class="hero-title-row">
      <h1 class="hero-title">Patients</h1>
    </div>
    <div class="hero-meta-line">
      <span class="meta-item">{{ patients.count }} patient{{ patients.count|pluralize }} under your care</span>
    </div>
  </div>
  <div class="hero-divider"></div>
</section>

<!-- Main card with patients -->
<div class="main-card">
  <div class="card-head">
    <h2>All Patients</h2>
    <div class="head-actions">
      <form method="get" style="display: flex; gap: 8px; align-items: center;">
        <input type="search" name="search" placeholder="Search by name, owner, species, breed..." value="{{ request.GET.search }}" style="padding: 8px 12px; border: 1px solid var(--dash-divider); border-radius: 8px; min-width: 300px;">
        <button class="btn btn-primary" type="submit">Search</button>
      </form>
    </div>
  </div>
  
  <div class="pet-grid">
    {% for p in patients %}
      <div class="pet-card">
        <div class="pet-card-header">
          {% if p.image_url or p.image %}
            <img src="{{ p.image_url|default:p.image.url }}" alt="{{ p.name }}" class="pet-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="pet-image-placeholder" style="display:none;">{{ p.name|slice:':1'|upper }}</div>
          {% else %}
            <div class="pet-image-placeholder">{{ p.name|slice:':1'|upper }}</div>
          {% endif %}
          <div class="pet-info">
            <div class="pet-name">{{ p.name }}</div>
            <div class="pet-species">{{ p.get_species_display_full|default:"Unknown" }}{% if p.breed %} â€¢ {{ p.breed }}{% endif %}</div>
          </div>
        </div>
        <div class="pet-card-body" style="padding: 12px 16px; border-top: 1px solid var(--dash-divider);">
          <div style="display: flex; flex-direction: column; gap: 6px; font-size: 13px; color: var(--dash-text-muted);">
            <div><strong>Owner:</strong> {{ p.owner.full_name }}</div>
            {% if p.sex %}<div><strong>Sex:</strong> {{ p.get_sex_display }}</div>{% endif %}
            {% if p.weight_kg %}<div><strong>Weight:</strong> {{ p.weight_kg }} kg</div>{% endif %}
          </div>
        </div>
        <div class="pet-card-actions">
          <a href="{% url 'vet_portal:patient_detail' p.id %}" class="pet-action">View Details</a>
        </div>
      </div>
    {% empty %}
      <div class="empty-message" style="grid-column: 1/-1;">
        <p style="margin: 40px 0; font-size: 15px;">No patients found matching your search.</p>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
